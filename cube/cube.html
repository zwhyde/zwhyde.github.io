<!DOCTYPE html>
<html class=''>
<head>
    <meta charset='UTF-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no,maximum-scale=1.0">
    <meta name="robots" content="noindex">
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_1427432339_1327224.css"/>
    <link rel="stylesheet" href="cube.css"/>
</head>
<body>
<div class="wrapper">
    <div class="cube">
        <b class="front">
            <div class="cc">
                <div class="cr city">
                    <div class="ct">广州</div>
                </div>
                <div class="cr date">
                    <div class="ct">3月20日 星期四</div>
                </div>
                <div class="cr">
                    <div class="ct">
                        <i class="iconfont icon-qing"></i>
                    </div>
                    <div class="ct">
                        <span class="number">
                            20<sup>。</sup>
                        </span>
                    </div>
                </div>
                <div class="cr">
                    <div class="ct">
                         <span class="number">
                            3
                        </span>
                    </div>
                    <div class="ct">
                         <span class="number">
                            0.0
                        </span>
                    </div>
                </div>
                <div class="cr">
                    <div class="ct">
                         <span class="number">
                            3
                        </span>
                    </div>
                    <div class="ct">
                         <span class="number">
                            0.0
                        </span>
                    </div>
                </div>
            </div>
        </b>
        <b class="top">
            <div class="cc">
                <div class="cr city">
                    <div class="ct">广州</div>
                </div>
                <div class="cr date">
                    <div class="ct">3月20日 星期四</div>
                </div>
                <div class="cr">
                    <div class="ct">
                        <i class="iconfont icon-qing"></i>
                    </div>
                    <div class="ct">
                        <span class="number">
                            20<sup>。</sup>
                        </span>
                    </div>
                </div>
                <div class="cr">
                    <div class="ct">
                         <span class="number">
                            3
                        </span>
                    </div>
                    <div class="ct">
                         <span class="number">
                            0.0
                        </span>
                    </div>
                </div>
                <div class="cr">
                    <div class="ct">
                         <span class="number">
                            3
                        </span>
                    </div>
                    <div class="ct">
                         <span class="number">
                            0.0
                        </span>
                    </div>
                </div>
            </div>
        </b>
        <b class="bottom">
            <div class="cc">
                <div class="cr city">
                    <div class="ct">广州</div>
                </div>
                <div class="cr date">
                    <div class="ct">3月20日 星期四</div>
                </div>
                <div class="cr">
                    <div class="ct">
                        <i class="iconfont icon-qing"></i>
                    </div>
                    <div class="ct">
                        <span class="number">
                            20<sup>。</sup>
                        </span>
                    </div>
                </div>
                <div class="cr">
                    <div class="ct">
                         <span class="number">
                            3
                        </span>
                    </div>
                    <div class="ct">
                         <span class="number">
                            0.0
                        </span>
                    </div>
                </div>
                <div class="cr">
                    <div class="ct">
                         <span class="number">
                            3
                        </span>
                    </div>
                    <div class="ct">
                         <span class="number">
                            0.0
                        </span>
                    </div>
                </div>
            </div>
        </b>
        <b class="left">
            <div class="cc">
                <div class="cr city">
                    <div class="ct">广州</div>
                </div>
                <div class="cr date">
                    <div class="ct">3月20日 星期四</div>
                </div>
                <div class="cr">
                    <div class="ct">
                        <i class="iconfont icon-qing"></i>
                    </div>
                    <div class="ct">
                        <span class="number">
                            20<sup>。</sup>
                        </span>
                    </div>
                </div>
                <div class="cr">
                    <div class="ct">
                         <span class="number">
                            3
                        </span>
                    </div>
                    <div class="ct">
                         <span class="number">
                            0.0
                        </span>
                    </div>
                </div>
                <div class="cr">
                    <div class="ct">
                         <span class="number">
                            3
                        </span>
                    </div>
                    <div class="ct">
                         <span class="number">
                            0.0
                        </span>
                    </div>
                </div>
            </div>
        </b>
        <b class="right">
            <div class="cc">
                <div class="cr city">
                    <div class="ct">广州</div>
                </div>
                <div class="cr date">
                    <div class="ct">3月20日 星期四</div>
                </div>
                <div class="cr">
                    <div class="ct">
                        <i class="iconfont icon-qing"></i>
                    </div>
                    <div class="ct">
                        <span class="number">
                            20<sup>。</sup>
                        </span>
                    </div>
                </div>
                <div class="cr">
                    <div class="ct">
                         <span class="number">
                            3
                        </span>
                    </div>
                    <div class="ct">
                         <span class="number">
                            0.0
                        </span>
                    </div>
                </div>
                <div class="cr">
                    <div class="ct">
                         <span class="number">
                            3
                        </span>
                    </div>
                    <div class="ct">
                         <span class="number">
                            0.0
                        </span>
                    </div>
                </div>
            </div>
        </b>
        <!-- <i class="front"></i>
         <i class="back"></i>
         <i class="top"></i>
         <i class="bottom"></i>
         <i class="left"></i>
         <i class="right"></i>-->
    </div>
</div>
<!--<div class="overlay"></div>-->

<script src="js/jquery-1.11.1.js"></script>
<script>
    $(function () {
        var doc = document.documentElement;
        var width = doc.clientWidth, height = doc.clientHeight;
//        width=300;height=400;
        var cube = $('.cube'), cubeWrapper = $('.wrapper');
        cube.width(width);

        cubeWrapper.css({
            webkitPerspectiveOrigin: '50% ' + height / 2 + 'px'
        })

        cube.find('b').width(width).height(height);

        cube.find('b.right').css({
            webkitTransform: 'rotateY(90deg) translateX(' + width + 'px)'
        });
        cube.find('b.left').css({
            webkitTransform: 'rotateY(-90deg) translateX(' + (-width) + 'px)'
        });
        cube.find('b.top').css({
            webkitTransform: 'rotateX(90deg) translateY(' + (-height) + 'px)'
        });
        cube.find('b.bottom').css({
            webkitTransform: 'rotateX(-90deg) translateY(' + height + 'px)'
        });


        var isTouch = "ontouchstart" in window;
        var _slider = {

            el: {
                holder: cube
            },

            slideWidth: 200,
            touchstart: undefined,
            touchmove: undefined,
            moveDistance: undefined,
            currentIndex: 0,
            longTouch: undefined,
            longTouchTime: 250,
            currentRotate: 0,
            unit: 200 / 90,
            isMove: false,

            init: function () {
                this.bindUIEvents();
                this.length = 4;
            },
            getTotalWidth: function () {
                return (this.length - 1) * this.slideWidth;
            },
            getCurrentRotate: function () {
                return (this.currentIndex * this.slideWidth) / this.unit;
            },
            getDrectionX: function () {
                var d = this.touchstartx - this.touchmovex;
                return d > 0 ? 1 : (d < 0 ? -1 : 0);
            },
            getDrection: function (touchmove) {
                var _x = this.touchstart.pageX - touchmove.pageX, _y = this.touchstart.pageY - touchmove.pageY;
                return Math.abs(_x) >= Math.abs(_y) ? {d: 'h', vx: -_x, vy: _y} : {d: 'v', vx: -_x, vy: _y};
            },
            setCurrentIndex: function (currentIndex) {
                if (currentIndex <= -1) {
                    currentIndex = -1;
                }
                if (currentIndex > this.length - 1) {
                    currentIndex = this.length - 1
                }
                this.currentIndex = currentIndex;
            },
            bindUIEvents: function () {

                var event_start = isTouch ? "touchstart" : "mousedown",
                        event_move = isTouch ? "touchmove" : "mousemove",
                        event_end = isTouch ? "touchend" : "mouseup";
                var doc = $(document);

                doc.on(event_start, function (event) {
                    _slider.start(event);
                });

                doc.on(event_move, function (event) {
                    _slider.move(event);
                });

                doc.on(event_end, function (event) {
                    _slider.end(event);
                });

            },
            isOutBound: function (moveRotate) {
                if (this.currentDrection.d == 'h') {
                    return Math.abs(this.currentRotate + moveRotate.vx / this.unit) >= 90
                } else {
                    return Math.abs(this.currentRotate + moveRotate.vy / this.unit) >= 90
                }
            },
            start: function (event) {
                this.isMove = true;
                var self = this;
                this.el.holder.removeClass('animate');

                this.longTouch = false;
                setTimeout(function () {
                    self.longTouch = true;
                }, self.longTouchTime);

                this.touchstart = {
                    pageX: isTouch ? event.originalEvent.touches[0].pageX : event.pageX,
                    pageY: isTouch ? event.originalEvent.touches[0].pageY : event.pageY
                };
            },
            move: function (event) {
                if (!this.isMove) return;
                this.isMoving=true;
//                var touch = event.originalEvent.touches[0];

                var _touchmove = {
                    pageX: isTouch ? event.originalEvent.touches[0].pageX : event.pageX,
                    pageY: isTouch ? event.originalEvent.touches[0].pageY : event.pageY
                };

                var moveRotate = this.getDrection(_touchmove);

                this.currentDrection = this.currentDrection || moveRotate;

                if (this.isOutBound(moveRotate)) return;

                if (this.currentDrection.d == 'h') {
                    this.rotate = this.currentRotate + moveRotate.vx / this.unit;
                    this.el.holder.css('-webkit-transform-origin', width / 2 + 'px 0 ' + (-width / 2) + 'px');
                    this.el.holder.css('-webkit-transform', 'rotate3d(0,1,0,' + this.rotate + 'deg)');
                    this.moveDistance = moveRotate.vx;
                } else {
                    this.rotate = this.currentRotate + moveRotate.vy / this.unit;
                    this.el.holder.css('-webkit-transform-origin', '0 ' + height / 2 + 'px ' + (-(height) / 2) + 'px');
                    this.el.holder.css('-webkit-transform', 'rotate3d(1,0,0,' + this.rotate + 'deg)');
                    this.moveDistance = moveRotate.vy;
                }


            },
            end: function (event) {
                if(!this.isMoving) return;


                var _unitDeg = Math.round(this.rotate / 90);


                var targetDeg = _unitDeg * 90;

                if (this.longTouch == false) {

                    if (this.moveDistance > 0) {
                        targetDeg = this.currentRotate + 90;
                    } else {
                        targetDeg = this.currentRotate - 90;
                    }
                    targetDeg = targetDeg > 90 ? 90 : targetDeg;
                    targetDeg = targetDeg < -90 ? -90 : targetDeg;
                }


                if (this.currentDrection.d == 'h') {
                    this.el.holder.addClass('animate').css('-webkit-transform', 'rotate3d(0,1,0,' + targetDeg + 'deg)');
                } else {
                    this.el.holder.addClass('animate').css('-webkit-transform', 'rotate3d(1,0,0,' + targetDeg + 'deg)');
                }

                if (targetDeg == 0)
                    this.currentDrection = null;
                this.currentRotate = targetDeg;
                this.isMove = false;
                this.isMoving=false;
            }
        };
        _slider.init();

    })
</script>
</body>
</html>